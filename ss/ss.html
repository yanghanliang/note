<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        .box {
            width: 800px;
            height: 500px;
            display: table;
            margin: 50px auto;
            border: 1px solid #ddd;
        }

        .box>div {
            width: 400px;
            height: 100%;
            float: left;
            position: relative;
            margin: 400px auto;
            border: 1px solid red;
        }

        .crumbs:hover div {
            /* display: block; */
        }

        .crumbs div {
            /* display: none; */
            position: absolute;
            border-radius: 50%;
        }

        .crumbs .c-home{
            width: 300px;
            height: 300px;
            top: 50%;
            left: 50%;
            background-color: aquamarine;
            transform: translate(-50%, -50%);
        }

        .w6 {
            width: 60px;
            height: 60px;
            background-color: forestgreen;
            display: inline-block;
        }

        .crumbs .c-home .child {
            width: 100px;
            height: 100px;
            top: 0;
            left: 50%;
            background-color: bisque;
        }
    </style>
</head>
<body>
    <div class="box">
        <div class="box-left">
        </div>
    </div>

    <script>
        var data = [{val: 50, txt: 'a'}, {val: 55, txt: 'b'}, {val: 60, txt: 'c'}, {val: 10, txt: 'd'}, {val: 60, txt: 'c'}, {val: 60, txt: 'c'}, {val: 60, txt: 'c'}, {val: 60, txt: 'c'}, {val: 60, txt: 'c'}, {val: 60, txt: 'c'}, {val: 60, txt: 'c'}, {val: 60, txt: 'c'}, {val: 60, txt: 'c'}]
        var My = function (params) {
            this.box = document.querySelector(params.box)
            this.width = this.getStyle(this.box, 'width')
            this.height = this.getStyle(this.box, 'height')
            this.maxNumber = 0                                      // 小圆可能存在的最多个数
            this.data = params.data
            this.position = []                                      // 位置，坐标
            this.minWidth = params.minWidth                         // 小圆的最大宽
            this.maxValue = null                                    // 数据的最大值
            this.proportion = 0                                     // 比例 - 圆的大小和数据值的比例
            this.filed = params.filed
            console.log(this.width, this.height)

            this.init()
        }

        My.prototype.init = function () {
            this.maxNumber = this.getMaxNumber({
                maxWidth: this.width,
                maxHeight: this.height,
                minWidth: this.minWidth
            })
            this.compareData()
            console.log(this.maxNumber, 'this.maxNumber')
            this.forGetPosition()
            // this.maxValue = this.getMaxValue({
            //     data: this.data,
            // })
            this.srot()
            this.proportion = this.minWidth / this.maxValue
            this.createAllElement()
            console.log(this.proportion, 'this.proportion')
        }

        /**
         * 获取属性值
         * @param {object} ele  - DOM 对象
         * @param {string} attr - 属性
         * @returns {number} value 属性值
         *
         */
        My.prototype.getStyle = function (ele, attr) {
            if (window.getComputedStyle) {
                let value = window.getComputedStyle(ele, null)[attr]
                let index = value.indexOf('px')
                return Number(value.slice(0, index))
            } else {
                // console.log('老铁！解决下兼容')
                return el.currentStyle;
            }
        }

        /**
         * 获取盒子内可以装下最多小圆的个数
         * @param {object} params
         * @param {number} params.maxWidth 盒子宽度
         * @param {number} params.maxHeight 盒子高度
         * @param {number} params.minWidth 小圆的宽度
         * @return {number} 个数
         */
        My.prototype.getMaxNumber = function (params) {
            console.log(params.maxWidth * params.maxHeight / Math.pow(params.minWidth, 2), 'pp')
            //  - 2 可以防止内存溢出
            return ((params.maxWidth * params.maxHeight) / (params.minWidth * 2)) - 40
        }

        /**
         * 比较两个数的大小
         */
        My.prototype.compareData = function () {
            console.log(this.maxNumber, '>>>>')
            this.maxNumber = this.maxNumber > this.data.length ? this.data.length : this.maxNumber
            this.maxNumber = 4
        }

        /**
         * 获取某个范围的随机数
         * @param {number} min 最小值
         * @param {number} max 最大值
         * @returns {number} value - min 到 max 之间的值
         */
        My.prototype.random = function (min, max) {
            return Math.floor(Math.random() * (max - min + 1) + min)
        }

        /**
         * 获取坐标
         * 
         */
        My.prototype.getPosition = function () {
            let data = this.position
            let length = data.length
            let x = this.random(0, this.width - this.minWidth)
            let y = this.random(0, this.height - this.minWidth)
            // console.log(x, y, 'xy')
            let template = 0

            for (let i = 0; i < length; i++) {
                let item = data[i]
                let ifX = (x > item.x + this.minWidth && x < this.width) || (x + this.minWidth < item.x)
                let ifY = (y > item.y + this.minWidth && y < this.height) || (y + this.minWidth < item.y)
                let ifRangeX = ifX 
                let ifRangeY = ifY 
                let ifPosition = ifRangeX && ifRangeY
                let ifCollision = ifPosition && template === length - 1 // 判断是否碰撞
                // console.log(ifX, ifY, ifCollision, '???')

                if (ifPosition) {
                    template++
                } else {
                    this.getPosition()
                    break
                }

                if (ifCollision) {
                    this.position.push({
                        x: x,
                        y: y
                    })
                }
            }
        }

        /**
         * 获取需要的所有坐标
         */
        My.prototype.forGetPosition = function () {
            // 添加一个做对比
            this.position.push({
                x: this.random(0, this.width - this.minWidth),
                y: this.random(0, this.height - this.minWidth)
            })

            for (let i = 0; i < this.maxNumber - 1; i++) {
                this.getPosition()
            }
        }


        /**
         * 创建元素
         * @param {object} params
         * @param {number} params.val
         * @param {string} params.txt
         * @param {number} params.x
         * @param {number} params.y
         */
        My.prototype.createdEle = function (params) {
            let ele = document.createElement('div')
            let value = params.val * this.proportion

            console.log(value, ']]]]')

            ele.className = 'min-box'
            ele.style.width = value + 'px'
            ele.style.height = value + 'px'
            ele.innerText = params.txt ? params.txt : ''
            ele.style.top = params.y + 'px'
            ele.style.left = params.x + 'px'

            console.log(ele, this.box, 'ele')
            this.box.appendChild(ele)
        }

        /**
         * 获取最大值
         * @param {object} params
         * @param {array} params.data
         * @param {string} params.field
         * @return {number} 最大值
        */
        My.prototype.getMaxValue = function(params) {
            // [1, 2]
            // [{val: 1}, {val: 2}]
            let data = params.data
            let one = data[0]
            let type = typeof one
            let template = null
            let length = data.length
            console.log(type, 'type')

            if(type === 'object') {
                for(let i = 1; i < length; i++) {
                    let item = data[i]
                    if(item[field] > template[field]) {
                        template = item
                    }
                }
                return template[field]
            } else {
                for(let i = 1; i < length; i++) {
                    let item = data[i]
                    if(item > template) {
                        template = item
                    }
                }
                return template
            }
        }

        /**
         * 排序
        */
        My.prototype.srot = function() {
            let arr = this.data
            let type = typeof arr[0]

            if(type === 'object') {
                for (var i = 0; i < arr.length - 1; i++) {
                    for (var j = 0; j < arr.length - 1 - i; j++) {
                        if (arr[j][this.filed] < arr[j + 1][this.filed]) {
                            var temp = arr[j];
                            arr[j] = arr[j + 1];
                            arr[j + 1] = temp;
                        }
                    }
                }

                this.maxValue = arr[0][this.filed]
            } else {
                for (var i = 0; i < arr.length - 1; i++) {
                    for (var j = 0; j < arr.length - 1 - i; j++) {
                        if (arr[j] < arr[j + 1]) {
                            var temp = arr[j];
                            arr[j] = arr[j + 1];
                            arr[j + 1] = temp;
                        }
                    }
                }
                this.maxValue = arr[0]
            }

            console.log(arr, this.data)
        }

        /**
         * 创建所有元素
        */
        My.prototype.createAllElement = function() {
            for(let i = 0; i < this.maxNumber; i++) {
                let item = Object.assign({}, this.data[i], this.position[i])
                this.createdEle(item)
            }
        }

        new My({
            box: '.box-left',
            minWidth: 60, // 小圆圈的大小
            data: data,
            filed: 'val'
        })
    </script>
</body>
</html>